<!DOCTYPE html>
<html lang="id">
<head>
<base target="_top">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

<style>
:root { --primary: #1a73e8; --secondary: #5f6368; --success: #2ecc71; --bg: #CBCBCB; --card-bg: #ffffff; }
body { font-family: 'Inter', sans-serif; background-color: var(--bg); margin: 0; padding: 15px; color: #3c4043; }
.card { max-width: 800px; width: 100%; background: var(--card-bg); margin: 15px auto; padding: 30px; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); box-sizing: border-box; border: 1px solid #e0e0e0; }
.form-row { display: flex; gap: 15px; margin-bottom: 10px; }
.form-group { flex: 1; }
@media (max-width: 480px) { .form-row { flex-direction: column; gap: 0; } }
.page { display: none; animation: fadeIn 0.4s ease-out; }
.active { display: block }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
h2 { font-size: 1.5rem; text-align: center; color: var(--primary); margin-bottom: 10px; font-weight: 800; }
h3 { text-align: left; margin-top: 35px; color: #202124; border-left: 4px solid var(--primary); padding-left: 12px; font-size: 1.15rem; background: #f1f3f4; padding: 10px; border-radius: 0 8px 8px 0; }
label { font-weight: 600; margin-top: 20px; display: block; font-size: 0.85rem; color: #5f6368; }
label i { color: var(--primary); margin-right: 8px; width: 20px; text-align: center; }
input, select { width: 100%; padding: 12px 15px; margin-top: 8px; border-radius: 10px; border: 2px solid #edeff2; font-size: 15px; box-sizing: border-box; transition: all 0.3s ease; }
input:focus, select:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 4px rgba(26, 115, 232, 0.1); }
button { border: none; padding: 16px 24px; border-radius: 12px; cursor: pointer; font-size: 1rem; font-weight: 700; width: 100%; transition: all 0.3s ease; }
.btn-primary { background: var(--primary); color: #fff; }
.btn-secondary { background: #e8eaed; color: #3c4043; }
button:disabled { background: #dadce0; color: #9aa0a6; cursor: not-allowed; }
.btn-group { display: flex; flex-direction: column; gap: 15px; margin-top: 30px; }
@media (min-width: 600px) { .btn-group { flex-direction: row-reverse; } }
#file-list { margin-top: 15px; background: #f8f9fa; border: 2px dashed #dadce0; border-radius: 12px; padding: 15px; }
.file-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; background: #fff; border: 1px solid #e0e0e0; margin-bottom: 8px; border-radius: 8px; font-size: 0.85rem; }
.remove-btn { color: #d93025; font-weight: bold; cursor: pointer; }
.notice { background: #e6f4ea; color: #137333; padding: 15px; border-radius: 12px; margin-top: 20px; font-size: 0.9rem; border: 1px solid #ceead6; text-align: left; }
.notice label { margin-top: 0; display: flex; align-items: center; justify-content: flex-start; gap: 10px; color: #137333; }
.notice input[type="checkbox"] { width: 18px; height: 18px; margin: 0; cursor: pointer; }
.spinner { display: inline-block; animation: spin 1s linear infinite; font-size: 24px; }
@keyframes spin { 100% { transform:rotate(360deg); } }
</style>
</head>

<body>
<div class="card">

<div id="home" class="page active">
  <div style="text-align:center; margin-bottom: 20px;">
    <img src="Logo_Kota_Samarinda.png" alt="Logo" style="width: 120px; height: auto;">
  </div>
  <h2>FORMULIR PENDATAAN UJIAN SEKOLAH</h2>
  <h3 style="text-align:center; border:none; background:none; font-size: 24px; color: #333; margin-top: 5px;">SD NEGERI 006 SUNGAI PINANG</h3>
  <div class="notice">
    <strong><i class="fas fa-info-circle"></i> Perhatian:</strong> Pastikan seluruh data diisi dengan benar sesuai dokumen resmi (Akta lahir/Kartu Keluarga).
  </div>
  <div class="btn-group">
    <button class="btn-primary" onclick="show('data')">Mulai Pengisian</button>
  </div>
</div>

<form id="mainForm">
<div id="data" class="page">
  <h3><i class="fas fa-user-graduate"></i> DATA SISWA</h3>
  
  <label><i class="fas fa-school"></i> Kelas</label>
  <select id="kelas" required>
    <option value="">--Pilih--</option>
    <option>6-A</option>
    <option>6-B</option>
  </select>

  <div class="form-row">
    <div class="form-group">
      <label><i class="fas fa-id-card"></i> NISN</label>
      <input id="nisn" type="text" inputmode="numeric" placeholder="Wajib 10 Digit" required>
    </div>
    <div class="form-group">
      <label><i class="fas fa-fingerprint"></i> NIS</label>
      <input id="nis" type="text" inputmode="numeric" placeholder="Maks 10 Digit" required>
    </div>
  </div>
  
  <label><i class="fas fa-signature"></i> Nama Lengkap</label>
  <input id="nama" placeholder="Sesuai Akta" required>

  <div class="form-row">
    <div class="form-group">
      <label><i class="fas fa-map-marker-alt"></i> Tempat Lahir</label>
      <input id="tempat_lahir" placeholder="Kota/Kab" required>
    </div>
    <div class="form-group">
      <label><i class="fas fa-calendar-day"></i> Tanggal Lahir</label>
      <input id="tanggal_lahir" type="date" required>
    </div>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label><i class="fas fa-venus-mars"></i> Jenis Kelamin</label>
      <select id="jenis_kelamin" required>
        <option value="">--Pilih--</option>
        <option>Laki-laki</option>
        <option>Perempuan</option>
      </select>
    </div>
    <div class="form-group">
      <label><i class="fas fa-hands-praying"></i> Agama</label>
      <select id="agama" required>
        <option value="">--Pilih--</option>
        <option>A : ISLAM</option><option>B : KATOLIK</option><option>C : PROTESTAN</option><option>D : BUDHA</option><option>E : HINDU</option><option>F : LAINNYA</option>
      </select>
    </div>
  </div>

  <label><i class="fas fa-home"></i> Alamat Lengkap</label>
  <input id="alamat" placeholder="Nama Jalan, RT/RW" required>

  <label><i class="fas fa-map"></i> Kecamatan</label>
  <input id="kecamatan" required>

  <label><i class="fas fa-whatsapp"></i> Nomor HP / WhatsApp</label>
  <input id="hp" type="text" inputmode="numeric" placeholder="Maks 13 Digit (08...)" required>

  <h3><i class="fas fa-user-tie"></i> DATA AYAH</h3>
  <label><i class="fas fa-user"></i> Nama Ayah</label>
  <input id="nama_ayah" required>
  
  <div class="form-row">
    <div class="form-group">
      <label><i class="fas fa-briefcase"></i> Pekerjaan Ayah</label>
      <select id="pekerjaan_ayah" required>
        <option value="">--Pilih--</option>
        <option>A : PNS</option><option>B : TNI/POLRI</option><option>C : GURU/DOSEN</option><option>D : DOKTER</option><option>E : POLITIKUS</option><option>F : PEGAWAI SWASTA</option><option>G : PEDAGANG WIRASWASTA</option><option>H : PETANI/PETERNAK</option><option>I : SENIMAN</option><option>J : BURUH</option><option>K : DIRUMAH SAJA</option><option>L : LAINNYA</option>
      </select>
    </div>
    <div class="form-group">
      <label><i class="fas fa-user-graduate"></i> Pendidikan Ayah</label>
      <select id="pendidikan_ayah" required>
        <option value="">--Pilih--</option>
        <option>A : TIDAK TAMAT SD</option><option>B : SD/MI</option><option>C : SMP/MTs</option><option>D : SMA/MA</option><option>E : D1-D2</option><option>F : D3-D4</option><option>G : S1</option><option>H : S2</option><option>I : S3</option><option>J : LAINNYA</option>
      </select>
    </div>
  </div>
  
  <label><i class="fas fa-wallet"></i> Penghasilan Ayah</label>
  <select id="penghasilan_ayah" required>
    <option value="">--Pilih--</option>
    <option>A : < 500rb</option><option>B : 500rb - 1jt</option><option>C : 1jt - 3jt</option><option>D : 3jt - 5jt</option><option>E : > 5jt</option><option>F : Tidak berpenghasilan</option>
  </select>

  <h3><i class="fas fa-user-nurse"></i> DATA IBU</h3>
  <label><i class="fas fa-user"></i> Nama Ibu</label>
  <input id="nama_ibu" required>
  
  <div class="form-row">
    <div class="form-group">
      <label><i class="fas fa-briefcase"></i> Pekerjaan Ibu</label>
      <select id="pekerjaan_ibu" required>
        <option value="">--Pilih--</option>
        <option>A : PNS</option><option>B : TNI/POLRI</option><option>C : GURU/DOSEN</option><option>D : DOKTER</option><option>E : POLITIKUS</option><option>F : PEGAWAI SWASTA</option><option>G : PEDAGANG WIRASWASTA</option><option>H : PETANI/PETERNAK</option><option>I : SENIMAN</option><option>J : BURUH</option><option>K : DIRUMAH SAJA</option><option>L : LAINNYA</option>
      </select>
    </div>
    <div class="form-group">
      <label><i class="fas fa-user-graduate"></i> Pendidikan Ibu</label>
      <select id="pendidikan_ibu" required>
        <option value="">--Pilih--</option>
        <option>A : TIDAK TAMAT SD</option><option>B : SD/MI</option><option>C : SMP/MTs</option><option>D : SMA/MA</option><option>E : D1-D2</option><option>F : D3-D4</option><option>G : S1</option><option>H : S2</option><option>I : S3</option><option>J : LAINNYA</option>
      </select>
    </div>
  </div>
  
  <label><i class="fas fa-wallet"></i> Penghasilan Ibu</label>
  <select id="penghasilan_ibu" required>
    <option value="">--Pilih--</option>
    <option>A : < 500rb</option><option>B : 500rb - 1jt</option><option>C : 1jt - 3jt</option><option>D : 3jt - 5jt</option><option>E : > 5jt</option><option>F : Tidak berpenghasilan</option>
  </select>

  <h3><i class="fas fa-star"></i> DATA PENUNJANG</h3>
  <div class="form-row">
    <div class="form-group">
      <label><i class="fas fa-palette"></i> Hobi</label>
      <select id="hobi" required>
        <option value="">--Pilih--</option>
        <option>A : OLAH RAGA</option><option>B : KESENIAN</option><option>C : MEMBACA</option><option>D : MENULIS</option><option>E : TRAVELING</option><option>F : LAINNYA</option>
      </select>
    </div>
    <div class="form-group">
      <label><i class="fas fa-bullseye"></i> Cita-cita</label>
      <select id="cita" required>
        <option value="">--Pilih--</option>
        <option>A : PNS</option><option>B : TNI/POLRI</option><option>C : GURU</option><option>D : DOKTER</option><option>E : POLITIKUS</option><option>F : WIRASWASTA</option><option>G : SENIMAN</option><option>H : LAINNYA</option>
      </select>
    </div>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label><i class="fas fa-bus"></i> Transportasi</label>
      <select id="transport" required>
        <option value="">--Pilih--</option>
        <option>A : JALAN KAKI</option><option>B : SEPEDA</option><option>C : MOTOR</option><option>D : MOBIL</option><option>E : ANTAR JEMPUT</option><option>F : ANGKUTAN UMUM</option><option>G : LAINNYA</option>
      </select>
    </div>
    <div class="form-group">
      <label><i class="fas fa-route"></i> Jarak Sekolah</label>
      <select id="jarak" required>
        <option value="">--Pilih--</option>
        <option>A : 0-1 KM</option><option>B : 1-3 KM</option><option>C : 3-5 KM</option><option>D : 5-10 KM</option><option>E : > 10 KM</option>
      </select>
    </div>
  </div>

  <h3><i class="fas fa-file-upload"></i> UPLOAD BERKAS</h3>
  <label>Pilih File (Maksimal 5)</label>
  <input id="files-input" type="file" multiple accept="image/*,.pdf">
  <div id="file-list"><span>Belum ada file.</span></div>

  <div class="notice">
    <label>
      <input type="checkbox" id="cek" required>
      <span>Data yang saya isi sudah benar.</span>
    </label>
  </div>

  <div id="loader" style="display:none; text-align:center; margin:20px;">
    <span class="spinner">‚è≥</span> <span id="loadingText">Mengirim...</span>
  </div>

  <div class="btn-group" id="action-buttons">
    <button type="button" class="btn-primary" id="btnKirim" onclick="kirim()" disabled>Kirim Data</button>
    <button type="button" class="btn-secondary" onclick="show('home')">Kembali</button>
  </div>
</div>
</form>

<div id="notif" class="page" style="text-align:center; padding: 40px 10px;">
  <span style="font-size: 60px;">‚úÖ</span>
  <h2>Data Berhasil Terkirim!</h2>
  <button class="btn-primary" style="max-width: 200px;" onclick="location.reload()">Isi Formulir Baru</button>
</div>

</div>

<script>
let storageFiles = [];
// GANTI DENGAN URL DEPLOY TERBARU ANDA
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxYVFksf0LR4Jh-ZInUeuumNAibXBiqXmp-84tQDRy4NZS964eeax5qUEyrIvTmRcukDA/exec";

// ================== LOGIKA EYD ==================
function formatEYD(str) {
  return str.toLowerCase().replace(/(^|\s|\.)\S/g, (l) => l.toUpperCase());
}

// ================== SETUP LISTENERS ==================
function setupInputListeners() {
  // 1. Kapital Otomatis
  document.querySelectorAll('#nama, #nama_ayah, #nama_ibu, #tempat_lahir, #alamat, #kecamatan').forEach(el => {
    el.addEventListener('input', function() {
      let start = this.selectionStart;
      this.value = formatEYD(this.value);
      this.setSelectionRange(start, start);
    });
  });

  // 2. Proteksi Angka & Limit Digit
  // NISN: Harus Digit, Maksimal 10
  document.getElementById('nisn').addEventListener('input', function() {
    this.value = this.value.replace(/\D/g, '').slice(0, 10);
  });

  // NIS: Harus Digit, Maksimal 10
  document.getElementById('nis').addEventListener('input', function() {
    this.value = this.value.replace(/\D/g, '').slice(0, 10);
  });

  // HP: Harus Digit, Maksimal 13
  document.getElementById('hp').addEventListener('input', function() {
    this.value = this.value.replace(/\D/g, '').slice(0, 13);
  });
}

setupInputListeners();

function show(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  window.scrollTo(0,0);
}

const fileInput = document.getElementById('files-input');
fileInput.addEventListener('change', function(e) {
  [...e.target.files].forEach(file => { if(storageFiles.length < 5) storageFiles.push(file); });
  renderFiles();
  cekValidasi();
});

function renderFiles() {
  const list = document.getElementById('file-list');
  if(storageFiles.length === 0) { list.innerHTML = "Belum ada file."; return; }
  list.innerHTML = storageFiles.map((f, i) => `<div class="file-item"><span>üìÑ ${f.name}</span><span class="remove-btn" onclick="hapusFile(${i})">Hapus</span></div>`).join('');
}

function hapusFile(i) { storageFiles.splice(i, 1); renderFiles(); cekValidasi(); }

document.getElementById('mainForm').addEventListener('input', cekValidasi);
document.getElementById('mainForm').addEventListener('change', cekValidasi);

// ================== LOGIKA VALIDASI TOMBOL ==================
function cekValidasi() {
  const nisnVal = document.getElementById('nisn').value;
  const nisVal = document.getElementById('nis').value;
  const hpVal = document.getElementById('hp').value;
  const isCekChecked = document.getElementById('cek').checked;
  const form = document.getElementById('mainForm');
  
  // VALIDASI UTAMA: 
  const isNisnValid = nisnVal.length === 10; // NISN HARUS TEPAT 10 DIGIT
  const isNisValid = nisVal.length > 0;      // NIS BOLEH BERAPAPUN (MAKS 10 DIATUR DI INPUT) TAPI TIDAK KOSONG
  const isHpValid = hpVal.length >= 10;      // HP MINIMAL 10 DIGIT
  const isFormValid = form.checkValidity();
  
  document.getElementById('btnKirim').disabled = !(isFormValid && isNisnValid && isNisValid && isHpValid && isCekChecked);
}

async function kirim() {
  const loader = document.getElementById('loader');
  const actionButtons = document.getElementById('action-buttons');
  const namaSiswa = document.getElementById('nama').value.trim().replace(/[^a-z0-9]/gi, '_');

  actionButtons.style.display = "none";
  loader.style.display = "block";

  try {
    const readAsBase64 = (file) => new Promise((resolve) => {
      const reader = new FileReader();
      reader.onload = () => resolve({ data: reader.result.split(',')[1], type: file.type, ext: file.name.split('.').pop() });
      reader.readAsDataURL(file);
    });

    const fileData = await Promise.all(storageFiles.map(readAsBase64));
    const namedFiles = fileData.map((file, index) => ({ ...file, customName: `${namaSiswa}_${index + 1}` }));

    const dataObj = {
      kelas: document.getElementById('kelas').value,
      nisn: document.getElementById('nisn').value.trim(),
      nis: document.getElementById('nis').value.trim(),
      nama: document.getElementById('nama').value.trim(),
      tempat_lahir: document.getElementById('tempat_lahir').value.trim(),
      tanggal_lahir: document.getElementById('tanggal_lahir').value,
      jenis_kelamin: document.getElementById('jenis_kelamin').value,
      agama: document.getElementById('agama').value,
      alamat: document.getElementById('alamat').value.trim(),
      kecamatan: document.getElementById('kecamatan').value.trim(),
      hp: document.getElementById('hp').value.trim(),
      nama_ayah: document.getElementById('nama_ayah').value.trim(),
      pekerjaan_ayah: document.getElementById('pekerjaan_ayah').value,
      pendidikan_ayah: document.getElementById('pendidikan_ayah').value,
      penghasilan_ayah: document.getElementById('penghasilan_ayah').value,
      nama_ibu: document.getElementById('nama_ibu').value.trim(),
      pekerjaan_ibu: document.getElementById('pekerjaan_ibu').value,
      pendidikan_ibu: document.getElementById('pendidikan_ibu').value,
      penghasilan_ibu: document.getElementById('penghasilan_ibu').value,
      hobi: document.getElementById('hobi').value,
      cita: document.getElementById('cita').value,
      transport: document.getElementById('transport').value,
      jarak: document.getElementById('jarak').value,
      files: namedFiles 
    };
    
    await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(dataObj) });
    show('notif');
  } catch (err) {
    console.error(err);
    alert("Gagal mengirim. Periksa koneksi.");
    actionButtons.style.display = "flex";
    loader.style.display = "none";
  }
}
</script>
</body>
</html>